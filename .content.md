
<!-- markdownlint-disable MD001 -->
# How to use this module

```hcl
module "vault_dynamic_secret_mysql" {
  source  = "tf-vault-modules/dynamic-secrets-mysql/vault"
  version = "1.0.4"

  vault_mount_path = "database"
  db_username = "vault-user"
  db_password = "password"
  db_url = "mysql:3306"

  roles = [
    {
      role_name: "main"
      database_name: "wp-vault-test"
    },
    {
      role_name: "tf-modules"
      database_name: "wp-1"
    },
  ]
}
```

## Module Documentation

### Important Arguments

**lease_count_enabled** - Lease count quota; can be enable for Vault Enterprise only.

**default_creation_statements** - Module has integrated default creation statements, but this argument is for users who want to use different statements (also, there are: default_revocation_statements, default_renew_statements and default_rollback_statements). This will be applied to all defined roles

#### Roles Arguments

List of roles that will be created for database secret engine.

**role_name**: Name of the role
**database_name** (Optional): Not Used
**creation_statements**: If you don't want to use default statements or if you need to specify statements ONLY FOR THIS role (ie. Role generates user that can access only one database, etc)
**quota** (Optional):
  * Used to create rate limit quotas (on role endpoint)
  * If defined as {}, defaults are:
    * rate: 10
    * interval: 1
    * block_interval: 10


## FAQ

**Q:** What if I already have database secret engine enabled?

**A:** You can always import it.

```
terraform import module.vault_dynamic_secret_mysql.vault_mount.db YOUR_MOUNT_PATH
```

**Q:** How can I restrict role to only one database?

**A:** Use creation_statements for that role ([Basic example](<https://github.com/tf-vault-modules/terraform-vault-dynamic-secrets-mysql/blob/5729abb21eb00c8b84ee6b53eec1ef0523998e8e/examples/basic/main.tf#L36>))

**Q:** Do I have to prepare MySQL/MariaDB vault-admin user?

**A:** Absolutely! For test purposes, try to use following statements in your MySQL:

```SQL
DROP USER IF EXISTS 'vault-admin'@'%';
CREATE DATABASE IF NOT EXISTS `test-db`;
CREATE USER 'vault-admin'@'%' IDENTIFIED BY 'password';
GRANT ALL PRIVILEGES ON *.* TO 'vault-admin'@'%' WITH GRANT OPTION;
```

and use test-db in your module call.

**Q:** What is going to happen if I don't have specified database in MySQL?

**A:** This module will still generate user but it won't be able to do much.
